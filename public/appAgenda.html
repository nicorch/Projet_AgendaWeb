<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <title>Agenda</title>
    </head>

    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <h1 class="text-center" style="margin-bottom: 100px;">
                        Agenda des cours
                    </h1>
                    <div class="row">
                        <div class="col-6" v-for="unCours in cours">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title"></h5>
                                    <p class="card-text">
                                        {{ unCours.dateHeureDebut }}<br>
                                        {{ unCours.dateHeureFin }}<br>
                                    </p>
                                </div>
                                <div class="card-footer text-muted">
                                    <div class="row">
                                        <div class="col-8">
                                            
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-primary"
                                                v-on:click="getAvisByProfesseurId(professeur.id)">Avis</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            var app = new Vue({
                el: '#app',
                data: {
                    apiBase: 'http://localhost:8000/api',
                    professeurs: [],
                    profNotes: [],
                    professeurSelectionne: null,
                    avis: [],
                    nouvelAvis: {},
                    mesAvis: [],
                    cours: [],
                    date: null,
                },
                methods: {
                    getProfesseurs: function () {
                        axios.get(this.apiBase + '/professeurs')
                            .then(response => {
                                this.professeurs = response.data;
                                console.log(response.data);

                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getProfesseursAvis: function (professeurId) {
                        this.nouvelAvis = {
                            note: 0,
                            commentaire: "",
                            emailEtudiant: "",
                        }
                        axios.get(this.apiBase + '/professeur/' + professeurId + '/avis')
                            .then(response => {
                                this.avis = response.data;
                                this.professeurSelectionne = this.professeurs.find(professeur => professeur
                                    .id === professeurId)
                            }).catch(error => {
                                console.log(error);
                            });
                    },
                    putProfesseurAvis: function () {
                        axios.put(this.apiBase + '/professeur/' + this.professeurSelectionne.id + '/avis', this
                            .nouvelAvis)
                            .then(response => {
                                this.avis.push(response.data)
                                this.profNotes.push(this.professeurSelectionne)
                                this.mesAvis.push(response.data)
                            })
                            .catch(error => {
                                console.log(error);
                            })
                    },
                    deleteAvis: function (avis) {
                        axios.delete(this.apiBase + '/avis/' + avis.id)
                            .then(response => {
                                this.getProfesseursAvis(this.professeurSelectionne.id)
                                this.mesAvis.splice(this.mesAvis.indexOf(avis), 1)
                                this.profNotes.splice(this.profNotes.indexOf(this.professeurSelectionne), 1)
                            }).catch(error => {
                                console.log(error);
                            })
                    },
                    getCoursOfTheDay: function () {
                        axios.get(this.apiBase + '/cours/current')
                            .then(response => {
                                this.cours = response.data;
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getCoursOfTheDayBefore: function(){
                        date = new DateTime();
                        axios.get(this.apiBase + '/cours/before/' + date)
                            .then(response => {
                                this.cours = response.data;
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getCoursOfTheDayAfter: function(){
                        date = new DateTime();
                        axios.get(this.apiBase + '/cours/after/' + date)
                            .then(response => {
                                this.cours = response.data;
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    }
                },
                mounted() {
                    this.getProfesseurs();
                    //this.getCurrentCours();
                }
            });
        </script>
    </body>
</html>