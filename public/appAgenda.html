<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <title>Agenda</title>
    </head>

    <body>
        <div id="app" class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <h1 class="text-center" style="margin-bottom: 50px;">
                        Agenda des cours
                    </h1>
                    <div class="row">
                        <div class="col-12">
                            DATE : {{ date }}
                        </div>
                        <div class="col-2">
                            <button @click="getCoursOfTheDayBefore()"type="button" class="btn btn-primary">
								Jour précédent
                            </button>
                        </div>
                        <div class="col-2">
                            <button @click="getCoursOfTheDayAfter()" type="button" class="btn btn-primary">
								Jour suivant
                            </button>
                        </div>
                    </div>
                    <br>
                    <div id="div1" style="height: 500px;position:relative;">
                        <div id="div2" style="max-height:100%;overflow:auto;border:1px solid red;">
                            <div id="div3" style="height:1500px;border:5px solid yellow;">
                                <div class="row" v-for="unCours in cours">
                                    <div class="col-4" >
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title"><strong>{{ unCours.type.nom }} {{ unCours.matiere.titre }} - {{ unCours.matiere.reference }}</strong></h5><br>
                                                <p class="card-text">
                                                    {{ unCours.dateHeureDebut }}<br>
                                                    {{ unCours.dateHeureFin }}<br>
                                                </p>
                                                <p>
                                                    Salle: {{ unCours.salle.numero }}
                                                    Professeur: {{ unCours.professeur.nom }} {{ unCours.professeur.prenom }}      
                                                </p>
                                            </div>
                                            <div class="card-footer text-muted">
                                                <div class="row">
                                                    <div class="col-8">
                                                        
                                                    </div>
                                                    <div class="col-4">
                                                        <button class="btn btn-primary"
                                                            v-on:click="getAvisByProfesseurId(professeur.id)">Avis</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script type="text/javascript">
            var app = new Vue({
                el: '#app',
                data: {
                    apiBase: 'http://127.0.0.1:8000/api',
                    professeurs: [],
                    profNotes: [],
                    professeurSelectionne: null,
                    avis: [],
                    nouvelAvis: {},
                    mesAvis: [],
                    cours: [],
                    date: null,
                    dateDuJour: null,
                },
                methods: {
                    getProfesseurs: function () {
                        axios.get(this.apiBase + '/professeurs')
                            .then(response => {
                                this.professeurs = response.data;
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getProfesseursAvis: function (professeurId) {
                        this.nouvelAvis = {
                            note: 0,
                            commentaire: "",
                            emailEtudiant: "",
                        }
                        axios.get(this.apiBase + '/professeur/' + professeurId + '/avis')
                            .then(response => {
                                this.avis = response.data;
                                this.professeurSelectionne = this.professeurs.find(professeur => professeur
                                    .id === professeurId)
                            }).catch(error => {
                                console.log(error);
                            });
                    },
                    putProfesseurAvis: function () {
                        axios.put(this.apiBase + '/professeur/' + this.professeurSelectionne.id + '/avis', this
                            .nouvelAvis)
                            .then(response => {
                                this.avis.push(response.data)
                                this.profNotes.push(this.professeurSelectionne)
                                this.mesAvis.push(response.data)
                            })
                            .catch(error => {
                                console.log(error);
                            })
                    },
                    deleteAvis: function (avis) {
                        axios.delete(this.apiBase + '/avis/' + avis.id)
                            .then(response => {
                                this.getProfesseursAvis(this.professeurSelectionne.id)
                                this.mesAvis.splice(this.mesAvis.indexOf(avis), 1)
                                this.profNotes.splice(this.profNotes.indexOf(this.professeurSelectionne), 1)
                            }).catch(error => {
                                console.log(error);
                            })
                    },
                    getDateFormat: function () {
                        return this.dateDuJour.getDate()+"-"+(parseInt(this.dateDuJour.getMonth())+1)+"-"+this.dateDuJour.getFullYear();
                    },
                    setDateAuFormat: function () {
                        this.date = this.getDateFormat();
                    },
                    getCoursOfTheDay: function () {
                        axios.get(this.apiBase + '/cours/current')
                            .then(response => {
                                this.cours = response.data;
                                this.dateDuJour = new Date();
                                this.setDateAuFormat();
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getCoursOfTheDayBefore: function(){
                        this.dateDuJour.setDate(this.dateDuJour.getDate() - 1);                        
                        axios.get(this.apiBase + '/cours/before/' + this.getDateFormat())
                            .then(response => {
                                this.cours = response.data;
                                this.setDateAuFormat();
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    },
                    getCoursOfTheDayAfter: function(){
                        this.dateDuJour.setDate(this.dateDuJour.getDate() + 1);
                        axios.get(this.apiBase + '/cours/after/' + this.getDateFormat() )
                            .then(response => {
                                this.cours = response.data;
                                this.setDateAuFormat();
                                console.log(response.data);
                            })
                            .catch(error => {
                                console.log(error);
                            });
                    }
                },
                mounted() {
                    //this.getProfesseurs();
                    this.getCoursOfTheDay();
                }
            });
        </script>
    </body>
</html>